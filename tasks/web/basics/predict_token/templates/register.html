{% extends "base.html" %} {% block content %}
<div class="row justify-content-center">
  <div class="col-md-6">
    <div class="card card-soft p-4">
      <h4 class="mb-3">Create account</h4>
      <form id="regForm">
        <div class="mb-3">
          <label class="form-label">Username</label>
          <input
            name="username"
            class="form-control"
            required
            placeholder="username"
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Display name</label>
          <input
            name="display_name"
            class="form-control"
            placeholder="Your name"
          />
        </div>
        <div class="mb-3">
          <label class="form-label">Password</label>
          <input
            name="password"
            type="password"
            class="form-control"
            required
            placeholder="password"
          />
        </div>
        <button class="btn btn-accent w-100" type="submit">Register</button>
      </form>

      <div id="msg" class="mt-3" style="display: none"></div>
    </div>
  </div>
</div>

<script>
  document
    .getElementById("regForm")
    .addEventListener("submit", async function (e) {
      e.preventDefault();
      const fd = new FormData(this);
      const resp = await fetch("/register", { method: "POST", body: fd });
      const json = await resp
        .json()
        .catch(() => ({ success: false, error: "bad response" }));
      const msg = document.getElementById("msg");
      msg.style.display = "block";
      if (json.success) {
        // store token and redirect
        localStorage.setItem("api_token", json.token);
        msg.innerHTML =
          '<div class="alert alert-success">Registered. Redirecting to dashboardâ€¦</div>';
        setTimeout(() => (location.href = "/dashboard"), 700);
      } else {
        msg.innerHTML =
          '<div class="alert alert-danger">Error: ' +
          (json.error || "unknown") +
          "</div>";
      }
    });
</script>
{% endblock %}
